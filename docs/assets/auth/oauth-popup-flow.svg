---
---
<div>?xml version="1.0" encoding="UTF-8" standalone="no"?<svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1145px" preserveAspectRatio="none" style={{width: "1214px", height: "1145px", background: "#FEFEFE"}} version="1.1" viewBox="0 0 1214 1145" width="1214px" zoomAndPan="magnify">defsgOAuth Consent and Refresh FlowBrowserBrowserPopup WindowPopup Windowauth-backend pluginauth-backend pluginConsent ScreenConsent ScreenOAuth ProviderOAuth ProviderComponents on page ask for anaccess token with greaterscope than the existing session.Open popupGET /auth/&lt;provider&gt;/start?scope=some%20scopesRedirect to consent screen withrandom nonce in OAuth state andshort-lived cookie with the same nonce.GET /consent_url?redirect_uri=&lt;redirect_uri&gt;?nonce=&lt;n&gt;where redirect_uri=&lt;app-origin&gt;/auth/&lt;provider&gt;/handler/frameUser consents toaccess the new scope.Redirect to given redirect URL, with authorization codeGET /auth/&lt;provider&gt;/handler/frame?code=&lt;c&gt;&nonce=&lt;n&gt;Request includes the previously set none cookieVerify that the nonce in the cookiematches the nonce in the OAuth stateAuthorization CodeClient IDClient SecretVerify and generate tokensAccess Token(ID Token)(Refresh Token)ScopeExpire TimeSmall HTML page with inlined response payloadStore Refresh Token in HTTP-only cookiepostMessage() with tokens and info or errorClose selfA later point when a refreshis needed. Either because ofa reload or an expiring session.GET /auth/&lt;provider&gt;/tokenRefresh Token cookie includedRefresh TokenClient IDClient SecretAccess Token(ID Token)ScopeExpire TimeTokens and info</svg>
</div>